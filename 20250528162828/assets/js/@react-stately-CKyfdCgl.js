import{r as o}from"./react-In5IJgbb.js";import{s as R}from"./use-sync-external-store-DY2DQmcl.js";function W(t,e,i){let[s,r]=o.useState(t||e),a=o.useRef(t!==void 0),l=t!==void 0;o.useEffect(()=>{let u=a.current;u!==l&&console.warn(`WARN: A component changed from ${u?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}.`),a.current=l},[l]);let n=l?t:s,c=o.useCallback((u,...f)=>{let h=(m,...b)=>{i&&(Object.is(n,m)||i(m,...b)),l||(n=m)};typeof u=="function"?(console.warn("We can not support a function callback. See Github Issues for details https://github.com/adobe/react-spectrum/issues/2320"),r((b,...V)=>{let v=u(l?n:b,...V);return h(v,...f),l?b:v})):(l||r(u),h(u,...f))},[l,n,i]);return[n,c]}const w={badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valueMissing:!1,valid:!0},C={...w,customError:!0,valid:!1},p={isInvalid:!1,validationDetails:w,validationErrors:[]},O=o.createContext({}),I="__formValidationState"+Date.now();function G(t){if(t[I]){let{realtimeValidation:e,displayValidation:i,updateValidation:s,resetValidation:r,commitValidation:a}=t[I];return{realtimeValidation:e,displayValidation:i,updateValidation:s,resetValidation:r,commitValidation:a}}return F(t)}function F(t){let{isInvalid:e,validationState:i,name:s,value:r,builtinValidation:a,validate:l,validationBehavior:n="aria"}=t;i&&(e||(e=i==="invalid"));let c=e!==void 0?{isInvalid:e,validationErrors:[],validationDetails:C}:null,u=o.useMemo(()=>{if(!l||r==null)return null;let d=L(l,r);return k(d)},[l,r]);a!=null&&a.validationDetails.valid&&(a=void 0);let f=o.useContext(O),h=o.useMemo(()=>s?Array.isArray(s)?s.flatMap(d=>S(f[d])):S(f[s]):[],[f,s]),[m,b]=o.useState(f),[V,v]=o.useState(!1);f!==m&&(b(f),v(!1));let y=o.useMemo(()=>k(V?[]:h),[V,h]),A=o.useRef(p),[T,E]=o.useState(p),$=o.useRef(p),M=()=>{if(!D)return;x(!1);let d=u||a||A.current;g(d,$.current)||($.current=d,E(d))},[D,x]=o.useState(!1);return o.useEffect(M),{realtimeValidation:c||y||u||a||p,displayValidation:n==="native"?c||y||T:c||y||u||a||T,updateValidation(d){n==="aria"&&!g(T,d)?E(d):A.current=d},resetValidation(){let d=p;g(d,$.current)||($.current=d,E(d)),n==="native"&&x(!1),v(!0)},commitValidation(){n==="native"&&x(!0),v(!0)}}}function S(t){return t?Array.isArray(t)?t:[t]:[]}function L(t,e){if(typeof t=="function"){let i=t(e);if(i&&typeof i!="boolean")return S(i)}return[]}function k(t){return t.length?{isInvalid:!0,validationErrors:t,validationDetails:C}:null}function g(t,e){return t===e?!0:!!t&&!!e&&t.isInvalid===e.isInvalid&&t.validationErrors.length===e.validationErrors.length&&t.validationErrors.every((i,s)=>i===e.validationErrors[s])&&Object.entries(t.validationDetails).every(([i,s])=>e.validationDetails[i]===s)}function K(t){let e=o.useCallback(r=>t.subscribe(r),[t]),i=o.useCallback(()=>t.visibleToasts,[t]);return{visibleToasts:R.useSyncExternalStore(e,i,i),add:(r,a)=>t.add(r,a),close:r=>t.close(r),remove:r=>t.remove(r),pauseAll:()=>t.pauseAll(),resumeAll:()=>t.resumeAll()}}class N{subscribe(e){return this.subscriptions.add(e),()=>this.subscriptions.delete(e)}add(e,i={}){let s=Math.random().toString(36),r={...i,content:e,key:s,timer:i.timeout?new j(()=>this.close(s),i.timeout):void 0},a=0,l=this.queue.length;for(;a<l;){let c=Math.floor((a+l)/2);(r.priority||0)>(this.queue[c].priority||0)?l=c:a=c+1}this.queue.splice(a,0,r),r.animation=a<this.maxVisibleToasts?"entering":"queued";let n=this.maxVisibleToasts;for(;n<this.queue.length;)this.queue[n++].animation="queued";return this.updateVisibleToasts({action:"add"}),s}close(e){let i=this.queue.findIndex(a=>a.key===e);if(i>=0){var s,r;(s=(r=this.queue[i]).onClose)===null||s===void 0||s.call(r),this.queue.splice(i,1)}this.updateVisibleToasts({action:"close",key:e})}remove(e){this.updateVisibleToasts({action:"remove",key:e})}updateVisibleToasts(e){let{action:i,key:s}=e,r=this.queue.slice(0,this.maxVisibleToasts);if(i==="add"&&this.hasExitAnimation){let a=this.visibleToasts.filter(l=>!r.some(n=>l.key===n.key)).map(l=>({...l,animation:"exiting"}));this.visibleToasts=a.concat(r).sort((l,n)=>{var c,u;return((c=n.priority)!==null&&c!==void 0?c:0)-((u=l.priority)!==null&&u!==void 0?u:0)})}else i==="close"&&this.hasExitAnimation?this.visibleToasts=this.visibleToasts.map(a=>a.key!==s?a:{...a,animation:"exiting"}):this.visibleToasts=r;for(let a of this.subscriptions)a()}pauseAll(){for(let e of this.visibleToasts)e.timer&&e.timer.pause()}resumeAll(){for(let e of this.visibleToasts)e.timer&&e.timer.resume()}constructor(e){this.queue=[],this.subscriptions=new Set,this.visibleToasts=[];var i;this.maxVisibleToasts=(i=e==null?void 0:e.maxVisibleToasts)!==null&&i!==void 0?i:1;var s;this.hasExitAnimation=(s=e==null?void 0:e.hasExitAnimation)!==null&&s!==void 0?s:!1}}class j{reset(e){this.remaining=e,this.resume()}pause(){this.timerId!=null&&(clearTimeout(this.timerId),this.timerId=null,this.remaining-=Date.now()-this.startTime)}resume(){this.remaining<=0||(this.startTime=Date.now(),this.timerId=setTimeout(()=>{this.timerId=null,this.remaining=0,this.callback()},this.remaining))}constructor(e,i){this.startTime=null,this.remaining=i,this.callback=e}}export{O as $,W as a,K as b,N as c,G as d};
